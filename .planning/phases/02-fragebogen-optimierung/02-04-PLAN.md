---
phase: 02-fragebogen-optimierung
plan: 04
type: execute
---

<objective>
Add optional account creation at quiz end that works with or without signup.

Purpose: Enable persistent cross-device data while maintaining single-visit functionality
Output: Optional account screen with IndexedDB fallback
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@src/components/onboarding/OnboardingQuiz.tsx
@src/components/onboarding/QuizResults.tsx
@src/stores/user-store.ts

**Tech stack available:** IndexedDB, Nanostores for state management
**Established patterns:** saveQuizResults() function stores to IndexedDB
**Constraining decisions:** Account is optional - quiz must work without signup via IndexedDB persistence
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add account creation option to results screen</name>
  <files>src/components/onboarding/QuizResults.tsx</files>
  <action>Add account creation section at top of results screen. Display: "Möchten Sie ein Konto erstellen?" with two buttons: "Ja, Konto erstellen" (primary, elmex orange) and "Nein, ohne Konto fortfahren" (secondary, gray). Include benefits text: "Mit Konto: Zugriff von allen Geräten, personalisierte Beratung. Ohne Konto: Funktioniert nur auf diesem Gerät." Use state to track choice. If "Ja", show simple form (Email, Name fields only - no password for prototype simplicity). If "Nein", skip to results display. Form should not actually authenticate - just capture preference and data, store to IndexedDB with accountCreated flag.</action>
  <verify>Results screen shows account option, both paths (create/skip) work</verify>
  <done>Account creation screen appears before results, skip option works, form captures email/name</done>
</task>

<task type="auto">
  <name>Task 2: Update IndexedDB storage with account preference</name>
  <files>src/components/onboarding/OnboardingQuiz.tsx, src/stores/user-store.ts</files>
  <action>Modify saveQuizResults() in OnboardingQuiz.tsx to accept optional account data {email, name, accountCreated}. If account created, store additional fields in IndexedDB quiz-results object. Update user-store.ts to read account preference and display appropriate UI hints (e.g., "Logged in as [Name]" vs "Guest Mode"). No real authentication - just UI state management. Ensure quiz flow works identically whether account created or not.</action>
  <verify>IndexedDB contains account data when created, quiz works without account</verify>
  <done>Account data persists to IndexedDB, guest mode and account mode both functional</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Optional account creation flow at end of quiz</what-built>
  <how-to-verify>
    1. Run: npm run dev
    2. Complete entire quiz flow
    3. Verify: Account creation option appears before results
    4. Test Path 1: Click "Ja, Konto erstellen" → form appears with Email and Name fields → submit → results display
    5. Test Path 2: Click "Nein, ohne Konto fortfahren" → immediately see results
    6. Check: Both paths lead to functional results screen
    7. DevTools: Open Application → IndexedDB → elmex-db → quiz-results → verify account data saved when account created
    8. Refresh: Verify data persists
    9. Navigation: Verify no broken flows or missing data
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] npm run build succeeds without errors
- [ ] Account creation screen appears at quiz end
- [ ] Both create-account and skip paths work correctly
- [ ] IndexedDB stores account preference
- [ ] Quiz functionality identical with or without account
</verification>

<success_criteria>

- All tasks completed
- Optional account creation integrated
- Quiz works seamlessly in both modes (guest/account)
- Account data persists to IndexedDB
- Phase 2 complete - enhanced quiz ready for Phase 3
</success_criteria>

<output>
After completion, create `.planning/phases/02-fragebogen-optimierung/02-04-SUMMARY.md`
</output>
