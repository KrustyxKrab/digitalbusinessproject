---
phase: 10-products-overview-refactor
plan: 01
type: execute
---

<objective>
Replace hardcoded product list in src/pages/produkte/index.astro with dynamic data loading from JSON files.

Purpose: Eliminate product duplication, load all products dynamically from metadata files.
Output: Products overview page that dynamically loads and displays all 16 products.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/codebase/CONVENTIONS.md
@.planning/phases/08-product-data-migration/08-01-SUMMARY.md
@.planning/phases/09-dynamic-routing-implementation/09-01-SUMMARY.md
@src/pages/produkte/index.astro
@src/types/models.ts

**Tech stack available:**
- Astro file system API
- TypeScript ProductDetail interface
- Nanostores for user profile data

**Established patterns:**
- Product metadata: public/products/{slug}/product-info.json
- Dynamic routing: /produkte/{slug}

**Constraining decisions:**
- [08-01]: All 16 products have complete product-info.json
- [09-01]: Dynamic routing implemented
- [04-01]: "Für Ihre Routine/Vorgeschlagen" sections exist
- [04-01]: Product cards are clickable with hover effects

**Context:**
Products overview page currently has hardcoded product data. Now that all products have JSON metadata and dynamic routing works, refactor the overview to load products dynamically. Page should show "Für Ihre Routine" (if user has routine products) and "Alle Produkte" sections.
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement dynamic product loading in products overview</name>
  <files>src/pages/produkte/index.astro</files>
  <action>
    Refactor src/pages/produkte/index.astro to load products dynamically from JSON files instead of hardcoded data.

    Implementation:
    1. At the top of frontmatter, add function to load all products:
       ```typescript
       import fs from 'fs';
       import path from 'path';

       function loadAllProducts(): ProductDetail[] {
         const productsDir = path.join(process.cwd(), 'public', 'products');
         const folders = fs.readdirSync(productsDir);

         return folders
           .filter(folder => {
             const folderPath = path.join(productsDir, folder);
             return fs.statSync(folderPath).isDirectory();
           })
           .map(folder => {
             try {
               const jsonPath = path.join(productsDir, folder, 'product-info.json');
               const json = fs.readFileSync(jsonPath, 'utf-8');
               return JSON.parse(json) as ProductDetail;
             } catch (error) {
               console.error(`Failed to load product: ${folder}`, error);
               return null;
             }
           })
           .filter((p): p is ProductDetail => p !== null);
       }

       const allProducts = loadAllProducts();
       ```

    2. Remove all hardcoded product objects from the file

    3. Update product display sections:
       - Keep "Für Ihre Routine" logic (filter products based on user profile if available)
       - Display all products in "Alle Produkte" section using allProducts array
       - Maintain existing card layout and styling

    4. Product card structure:
       - Use product.slug for href: /produkte/${product.slug}
       - Use product image: /products/${product.slug}/${product.slug}_01.png
       - Display: product.name, product.description, product.price
       - Keep existing hover effects and button styling from Phase 04-01

    5. Maintain existing sections:
       - Product Finder (below hero)
       - FAQs (keep existing faq array)

    AVOID: Hardcoding any product data. All products MUST come from JSON files.

    WHY: Single source of truth for product data enables easy updates and additions without code changes.
  </action>
  <verify>
    npm run build succeeds, visit /produkte in dev server shows all 16 products dynamically loaded
  </verify>
  <done>
    Products overview displays all 16 products loaded from JSON metadata, no hardcoded product data remains
  </done>
</task>

<task type="auto">
  <name>Task 2: Remove deprecated hardcoded product pages</name>
  <files>
    src/pages/produkte/kariesschutz-zahnpasta.astro,
    src/pages/produkte/sensitive-zahnpasta.astro
  </files>
  <action>
    Delete the two hardcoded product page files now that dynamic routing is implemented.

    Files to remove:
    - src/pages/produkte/kariesschutz-zahnpasta.astro
    - src/pages/produkte/sensitive-zahnpasta.astro

    These are no longer needed since [slug].astro handles all product pages dynamically.

    Verification step: After deletion, ensure /produkte/kariesschutz-zahnpasta still works (should be served by [slug].astro, not the deleted file).

    AVOID: Leaving deprecated files that could cause confusion or routing conflicts.

    WHY: Clean codebase with single implementation reduces maintenance burden and eliminates duplication.
  </action>
  <verify>
    ls src/pages/produkte/ shows only index.astro and [slug].astro, npm run dev still serves /produkte/kariesschutz-zahnpasta correctly
  </verify>
  <done>
    Hardcoded product pages deleted, dynamic route handles all product pages
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Dynamic products overview page loading all 16 products from JSON</what-built>
  <how-to-verify>
    1. Run: npm run dev
    2. Visit: http://localhost:4321/produkte
    3. Verify: All 16 products display in grid layout
    4. Verify: Product cards show correct names, descriptions, images
    5. Verify: Click multiple product cards, should navigate to /produkte/{slug} correctly
    6. Verify: Product images load correctly (no broken images)
    7. Verify: "Für Ihre Routine" section shows if user has routine products (test with and without user data)
    8. Verify: Product Finder section still present below products
    9. Verify: FAQ section still present at bottom
    10. Test: Build with npm run build, verify no errors
    11. Confirm: Old hardcoded product pages deleted, routes still work
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] Products overview loads all products dynamically from JSON
- [ ] No hardcoded product data in index.astro
- [ ] Hardcoded product pages deleted (only index.astro and [slug].astro remain)
- [ ] All product cards clickable and navigate correctly
- [ ] Build succeeds without errors
</verification>

<success_criteria>

- Products overview completely dynamic
- All 16 products display correctly
- Hardcoded product pages removed
- Product system now fully JSON-driven
- Human verification confirms functionality
  </success_criteria>

<output>
After completion, create `.planning/phases/10-products-overview-refactor/10-01-SUMMARY.md`:

# Phase 10 Plan 1: Products Overview Refactor Summary

**Eliminated hardcoded products, implemented fully dynamic product system**

## Accomplishments

- Refactored products overview to load all products from JSON dynamically
- Removed all hardcoded product data from index.astro
- Deleted deprecated hardcoded product pages (kariesschutz-zahnpasta.astro, sensitive-zahnpasta.astro)
- Product system now fully JSON-driven: add new products by creating folder + JSON, no code changes required
- All 16 products display correctly in dynamic grid

## Files Created/Modified

- `src/pages/produkte/index.astro` - Refactored to load products dynamically
- `src/pages/produkte/kariesschutz-zahnpasta.astro` - DELETED
- `src/pages/produkte/sensitive-zahnpasta.astro` - DELETED

## Decisions Made

- loadAllProducts() function reads file system at build time
- Error handling: Invalid JSON logged but doesn't break build
- Product display order: Alphabetical by slug (natural file system order)
- "Für Ihre Routine" filtering: Checks user profile from localStorage client-side

## Issues Encountered

None

## Next Step

Ready for Phase 11 (Product System Integration)
</output>
