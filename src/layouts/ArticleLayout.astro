---
import Layout from './Layout.astro';
import ExpertProfile from '@/components/widgets/ExpertProfile.astro';
import StudyReference from '@/components/widgets/StudyReference.astro';
import StructuredData from '@/components/widgets/StructuredData.astro';

interface Props {
  title: string;
  description: string;
  keywords?: string;
  author: {
    name: string;
    title: string;
    credentials: string;
    image?: string;
    bio: string;
  };
  publishDate: Date;
  updateDate?: Date;
  readingTime: number;
  category?: string;
  tags?: string[];
  relatedArticles?: Array<{
    title: string;
    url: string;
    image?: string;
  }>;
}

const {
  title,
  description,
  keywords,
  author,
  publishDate,
  updateDate,
  readingTime,
  category = 'Zahngesundheit',
  tags = [],
  relatedArticles = []
} = Astro.props;

// Format dates
const formatDate = (date: Date) => date.toLocaleDateString('de-DE', {
  year: 'numeric',
  month: 'long',
  day: 'numeric'
});
---

<Layout title={title} description={description} keywords={keywords}>
  <!-- Article Schema.org -->
  <StructuredData
    type="article"
    data={{
      title,
      author: author.name,
      publishDate: publishDate.toISOString()
    }}
    slot="head"
  />

  <article class="container mx-auto px-4 py-16 max-w-4xl">
    <!-- Breadcrumbs -->
    <nav aria-label="Breadcrumb" class="mb-8">
      <ol class="flex items-center gap-2 text-sm text-neutral-600">
        <li><a href="/" class="hover:text-primary transition-colors">Start</a></li>
        <li aria-hidden="true">â†’</li>
        <li><a href="/blog" class="hover:text-primary transition-colors">Blog</a></li>
        {category && (
          <>
            <li aria-hidden="true">â†’</li>
            <li><a href={`/blog/${category.toLowerCase()}`} class="hover:text-primary transition-colors">{category}</a></li>
          </>
        )}
        <li aria-hidden="true">â†’</li>
        <li class="text-neutral-900" aria-current="page">{title}</li>
      </ol>
    </nav>

    <!-- Article Header -->
    <header class="mb-12">
      {category && (
        <span class="inline-block px-3 py-1 bg-primary/10 text-primary text-sm font-medium rounded-full mb-4">
          {category}
        </span>
      )}

      <h1 class="text-4xl md:text-5xl font-brand font-bold text-neutral-900 mb-4">
        {title}
      </h1>

      <p class="text-xl text-neutral-700 mb-6 leading-relaxed">
        {description}
      </p>

      <!-- Article Meta -->
      <div class="flex flex-wrap items-center gap-4 text-sm text-neutral-600 mb-6">
        <time datetime={publishDate.toISOString()}>
          VerÃ¶ffentlicht: {formatDate(publishDate)}
        </time>
        {updateDate && (
          <time datetime={updateDate.toISOString()}>
            Aktualisiert: {formatDate(updateDate)}
          </time>
        )}
        <span>ðŸ“– {readingTime} Min. Lesezeit</span>
      </div>

      <!-- Tags -->
      {tags.length > 0 && (
        <div class="flex flex-wrap gap-2">
          {tags.map(tag => (
            <a
              href={`/blog/tag/${tag.toLowerCase()}`}
              class="px-3 py-1 bg-neutral-100 text-neutral-700 text-xs rounded-full hover:bg-primary hover:text-white transition-colors"
            >
              #{tag}
            </a>
          ))}
        </div>
      )}
    </header>

    <!-- Author Profile -->
    <div class="mb-12">
      <ExpertProfile
        name={author.name}
        title={author.title}
        credentials={author.credentials}
        image={author.image}
        bio={author.bio}
      />
    </div>

    <!-- Article Content -->
    <div class="prose prose-lg max-w-none mb-12">
      <slot />
    </div>

    <!-- Article Footer -->
    <footer class="border-t border-neutral-200 pt-8 mt-12">
      <!-- Share Buttons -->
      <div class="mb-8">
        <h3 class="text-lg font-semibold text-neutral-900 mb-4">
          Artikel teilen
        </h3>
        <div class="flex gap-3">
          <a
            href={`https://www.facebook.com/sharer/sharer.php?u=${Astro.url}`}
            target="_blank"
            rel="noopener noreferrer"
            class="inline-flex items-center justify-center px-4 py-2 bg-[#1877F2] text-white rounded-lg hover:opacity-90 transition-opacity text-sm"
          >
            Facebook
          </a>
          <a
            href={`https://twitter.com/intent/tweet?url=${Astro.url}&text=${encodeURIComponent(title)}`}
            target="_blank"
            rel="noopener noreferrer"
            class="inline-flex items-center justify-center px-4 py-2 bg-[#1DA1F2] text-white rounded-lg hover:opacity-90 transition-opacity text-sm"
          >
            Twitter
          </a>
          <a
            href={`https://www.linkedin.com/shareArticle?mini=true&url=${Astro.url}&title=${encodeURIComponent(title)}`}
            target="_blank"
            rel="noopener noreferrer"
            class="inline-flex items-center justify-center px-4 py-2 bg-[#0A66C2] text-white rounded-lg hover:opacity-90 transition-opacity text-sm"
          >
            LinkedIn
          </a>
          <button
            id="copy-link"
            class="inline-flex items-center justify-center px-4 py-2 bg-neutral-200 text-neutral-900 rounded-lg hover:bg-neutral-300:bg-neutral-600 transition-colors text-sm"
          >
            Link kopieren
          </button>
        </div>
      </div>

      <!-- Related Articles -->
      {relatedArticles.length > 0 && (
        <div class="mb-8">
          <h3 class="text-2xl font-brand font-bold text-neutral-900 mb-6">
            Verwandte Artikel
          </h3>
          <div class="grid md:grid-cols-3 gap-6">
            {relatedArticles.map(article => (
              <a
                href={article.url}
                class="group bg-white rounded-xl p-4 border border-neutral-200 hover:border-primary hover:shadow-lg transition-all"
              >
                {article.image && (
                  <div class="w-full h-32 bg-neutral-100 rounded-lg mb-3 overflow-hidden">
                    <img
                      src={article.image}
                      alt={article.title}
                      class="w-full h-full object-cover group-hover:scale-105 transition-transform"
                    />
                  </div>
                )}
                <h4 class="font-semibold text-neutral-900 group-hover:text-primary transition-colors">
                  {article.title}
                </h4>
              </a>
            ))}
          </div>
        </div>
      )}

      <!-- CTA -->
      <div class="bg-gradient-to-br from-primary/5 to-primary/10 rounded-2xl p-8 text-center">
        <h3 class="text-2xl font-brand font-bold text-neutral-900 mb-3">
          Finden Sie die richtige Zahnpasta fÃ¼r Ihre BedÃ¼rfnisse
        </h3>
        <p class="text-neutral-700 mb-6">
          Nutzen Sie unseren Produktfinder fÃ¼r eine persÃ¶nliche Empfehlung
        </p>
        <a
          href="/beratung/produktfinder"
          class="inline-flex items-center justify-center px-8 py-3 text-base font-medium text-white bg-primary hover:bg-primary-dark transition-colors rounded-full"
        >
          Zum Produktfinder
        </a>
      </div>
    </footer>
  </article>
</Layout>

<script>
  // Copy link functionality
  document.getElementById('copy-link')?.addEventListener('click', async () => {
    try {
      await navigator.clipboard.writeText(window.location.href);
      const btn = document.getElementById('copy-link');
      if (btn) {
        const originalText = btn.textContent;
        btn.textContent = 'âœ“ Kopiert!';
        setTimeout(() => {
          btn.textContent = originalText;
        }, 2000);
      }
    } catch (err) {
      console.error('Failed to copy:', err);
    }
  });
</script>

<style>
  /* Enhanced prose styles for article content */
  .prose {
    @apply text-neutral-700;
  }

  .prose h2 {
    @apply text-3xl font-brand font-bold text-neutral-900 mt-12 mb-6;
  }

  .prose h3 {
    @apply text-2xl font-brand font-semibold text-neutral-900 mt-8 mb-4;
  }

  .prose p {
    @apply leading-relaxed mb-6;
  }

  .prose ul, .prose ol {
    @apply my-6 ml-6;
  }

  .prose li {
    @apply mb-2;
  }

  .prose a {
    color: #FF6000;
    transition: all 0.3s;
  }

  .prose a:hover {
    color: #CC4D00;
    text-decoration: underline;
  }

  .prose strong {
    @apply text-neutral-900 font-semibold;
  }

  .prose blockquote {
    @apply border-l-4 border-primary pl-4 italic text-neutral-600 my-6;
  }

  .prose img {
    @apply rounded-xl my-8;
  }

  .prose code {
    @apply bg-neutral-100 px-2 py-1 rounded text-sm;
  }
</style>
